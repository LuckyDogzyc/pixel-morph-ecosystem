# PRD: 像素风开放世界变形生物链小游戏

## 1. Executive Summary

本项目是一个像素风开放世界网页小游戏。主角是可变形生物，玩家通过“吃到食物”变身为对应生物，并在完整的生物链体系中生存、捕食、躲避更强生物。玩家以鼠标控制方向，WASD 与鼠标左键按住都可移动，空格触发技能/冲刺（2 秒冷却）。移动端使用虚拟摇杆与技能按键。系统记录得分与排行榜，死亡条件为生命值清空。攻击、变身与死亡等关键动作需要有动画表现。

MVP 目标：实现可玩、可循环的变形与食物链体验，让玩家在 5 分钟内理解玩法并持续获得成长与得分反馈。

## 2. Mission

- 用最直观的方式让玩家体验“食物链生态”
- 通过变形机制提供持续的新鲜感
- 让规则清晰、上手简单、体验上头

## 3. Target Users

- 喜欢轻量动作/生存类网页小游戏的玩家
- 对像素风美术和开放世界探索有兴趣的人
- 希望短时间内获得“成长/强化”反馈的休闲用户

## 4. MVP Scope

### ✅ In Scope

**核心玩法**
- 主角可变形：吃到食物变身为对应生物
- 生态链完整闭环，遵循自然规律并可扩展（本版用宝可梦属性克制循环）
- 各类生物在世界中刷新、移动
- 碰到弱小生物得分；吃食物变身不计分
- 被强大生物碰到扣血，生命值以红心显示
- 生命值清空死亡
- 攻击/变身/死亡有明确动画表现
- 排行榜记录得分

**交互与控制**
- 鼠标决定朝向
- WASD 与鼠标左键按住都可移动
- 空格触发技能/冲刺（2 秒冷却，可作为攻击）
- 移动端：虚拟摇杆 + 技能按键

**AI 行为**
- 强于主角的生物主动追逐主角
- 弱于主角的生物逃离主角
- 同级生物对主角基本中立（轻微游走）
- 所有非主角生物移动速度略慢于主角
- 生物之间也遵循食物链逻辑，并会正常互相攻击/逃跑/追逐

### ❌ Out of Scope

- 多人联机
- 高级技能树/装备系统
- 复杂任务系统或剧情
- 物理模拟级别的真实生态
- 高级特效与动态天气

## 5. User Stories

1. 作为玩家，我希望主角吃到食物后能立刻变身，以获得新的捕食与生存能力。
2. 作为玩家，我希望通过吃弱小生物得分，看到清晰的成长反馈。
3. 作为玩家，我希望强大生物会主动追我，让游戏更有压迫感。
4. 作为玩家，我希望弱小生物会逃跑，让捕食变得有挑战。
5. 作为玩家，我希望血量以红心显示，清楚知道还能活多久。
6. 作为玩家，我希望死亡后能看到我的得分排名。
7. 作为玩家，我希望只用鼠标就能操作，降低上手成本。
8. 作为玩家，我希望攻击、变身与死亡有清晰动画反馈，提升爽感和可读性。

## 6. Core Architecture & Patterns

- **渲染层**：Canvas/像素渲染
- **实体系统**：Entity + 状态/类型 + 组件数据（位置、速度、等级、形态）
- **AI 状态机**：追逐 / 逃离 / 游走
- **生态链/属性结构**：数据驱动的循环克制表（可扩展，默认火克草克水克火）
- **碰撞检测**：主角 vs 生物 / 主角 vs 食物 / 生物 vs 生物
- **得分与排行榜**：本地存储或简单后端

## 7. Tools / Features

- 世界生成与刷新
- 食物随机刷新系统
- 生物刷新系统
- 变形系统（主角形态切换）
- 生态链/属性克制配置（可扩展、可替换）
- AI 行为逻辑
- 攻击/变身/死亡动画
- 计分与排行榜
- 生命值与死亡逻辑

## 8. Technology Stack（可调整）

**建议（MVP）**
- 前端：HTML5 + Canvas
- 渲染/引擎：PixiJS 或 Phaser
- 语言：TypeScript
- 构建：Vite
- 数据存储（MVP）：LocalStorage（排行榜本地）

> 可选升级：使用简单后端存储排行榜（如 Supabase / Firebase / 自建 API）。

## 9. Security & Configuration

- MVP 仅本地排行榜，无需账号系统
- 如接入线上排行榜需防刷分与简单校验
- 配置项：生物链配置、刷新频率、速度倍率、血量上限

## 10. API Specification（可选）

若接入线上排行榜：

- `POST /api/score` 提交分数
  - body: `{ name, score, ts }`
- `GET /api/leaderboard` 获取前 N 名

MVP 可先跳过，使用本地排行榜。

## 11. Success Criteria

- 玩家 30 秒内理解玩法
- 变形与捕食逻辑清晰稳定
- AI 行为符合“追/逃/中立”规则
- 非主角生物之间有完整的捕食/逃跑互动
- 无最强最弱（生物链闭环成立）
- 5 分钟平均游戏时长 ≥ 1 次死亡/重开

## 12. Implementation Phases

### Phase 1: 核心循环
- ✅ 基础渲染与世界
- ✅ 主角移动与朝向
- ✅ 食物生成与变形

### Phase 2: 生物链与 AI
- ✅ 生物链结构
- ✅ 生物刷新
- ✅ 追逐/逃离逻辑

### Phase 3: 评分与死亡
- ✅ 得分系统
- ✅ 红心血量
- ✅ 攻击/变身/死亡动画
- ✅ 死亡与重置

### Phase 4: 排行榜与体验优化
- ✅ 排行榜（本地或线上）
- ✅ 简单 UI 提示
- ✅ 性能优化

## 13. Future Considerations

- 宝可梦属性克制表扩展（多属性、多克制关系）
- 进化系统（成长/分支进化）
- 技能系统（右键技能）
- 不同地形/障碍物
- 任务/成就系统
- 多人模式

## 14. Risks & Mitigations

- **生物链平衡困难**：先做 6-8 种，环状闭环
- **AI 逻辑过复杂**：先做简单状态机
- **性能问题**：限制单位数量，使用空间分区
- **规则不清晰**：强化 UI 提示与教学

## 15. Appendix

### 关键假设

- 生态链采用“闭环结构”（无最强/最弱）
- 第一版采用宝可梦三系循环：火克草、草克水、水克火（示例：小火龙/妙蛙种子/杰尼龟）
- 生态链规则由配置文件驱动，后续替换属性表即可扩展
- MVP 排行榜可先用本地存储
- 像素风素材可用简单占位图起步

### 待确认

- 第一版生物是否仅用小火龙/妙蛙种子/杰尼龟（或再加 1-2 层进化）
- 以后是否完全使用宝可梦体系（决定属性规则表规模）
- 是否需要正式线上排行榜
- 是否要加入地形/障碍物
